<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Temperatura</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Reset b√°sico e configura√ß√µes gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f4f7fa;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Estilo para a janela modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 2px solid #005f99;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #001f3f;
            font-weight: 600;
            text-align: center;
        }

        .modal-content select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            font-size: 14px;
            margin-bottom: 20px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .modal-content select:focus {
            border-color: #005f99;
            box-shadow: 0 0 8px rgba(0, 95, 153, 0.2);
            outline: none;
        }

        .modal-content button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #001f3f, #003087);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .modal-content button:hover {
            background: linear-gradient(135deg, #003087, #005f99);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* Estilo para o bot√£o Trocar Unidade */
.change-unit-button {
    padding: 8px 16px; /* Reduzido para tornar o bot√£o menor */
    background: linear-gradient(135deg, #005f99, #0077cc);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px; /* Tamanho da fonte reduzido */
    transition: all 0.3s ease;
    margin-top: 10px;
    display: inline-block; /* Garante que o bot√£o n√£o ocupe a largura total */
}

.change-unit-button:hover {
    background: linear-gradient(135deg, #003087, #005f99);
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

        /* Estilo para o subt√≠tulo da unidade */
        .unit-subtitle {
            font-size: 18px;
            color: #001f3f;
            margin-top: 5px;
            font-weight: 500;
        }

        /* Barra de t√≠tulo */
        .header {
            background-color: #ffffff;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1100;
        }

        .header-logo {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            height: 100px;
            width: auto;
            z-index: 1200;
            transition: transform 0.3s ease;
        }

        .header-logo:hover {
            transform: translateY(-50%) scale(1.05);
        }

        .header h1 {
            font-size: 28px;
            color: #001f3f;
            font-weight: 700;
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .header h1:hover {
            transform: scale(1.05);
            color: #005f99;
        }

        .header h1::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 3px;
            background-color: #005f99;
            transition: width 0.3s ease;
        }

        .header h1:hover::after {
            width: 100%;
        }

        /* Barra de navega√ß√£o */
        nav {
            background-color: #001f3f;
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 80px;
            z-index: 1000;
        }

        .tabs {
            display: flex;
            gap: 20px;
        }

        .tab-button {
            background: linear-gradient(135deg, #08325f, #1d4ca5);
            border: none;
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .tab-button:hover {
            background: linear-gradient(135deg, #003087, #005f99);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #005f99, #0077cc);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            height: 3px;
            background-color: #ffffff;
            border-radius: 2px;
        }

        /* √Årea de conte√∫do */
        .content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 20px;
        }

        .content-frame {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 1200px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .content-frame:hover {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        h2 {
            margin-bottom: 20px;
            color: #001f3f;
            font-weight: 600;
        }

        p {
            line-height: 1.6;
        }

        /* Estilos para formul√°rios e cards */
        .form-group {
            display: flex;
            flex-wrap: nowrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #001f3f;
        }

        .form-group input, .form-group select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            width: 100%;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: #f9f9f9;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: #005f99;
            box-shadow: 0 0 8px rgba(0, 95, 153, 0.2);
            outline: none;
        }

        .form-group input#data {
            max-width: 150px;
        }

        .form-group select#dados-mnemonico {
            max-width: 150px;
        }

        .form-group select#dados-responsavel {
            min-width: 150px;
            max-width: 250px;
        }

        .form-group input[type="number"] {
            max-width: 100px;
        }

        .form-group input.invalid, .form-group select.invalid {
            border-color: #ff4d4d;
            background-color: #ffecec;
        }

        .form-group button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #001f3f, #003087);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: flex-end;
            font-weight: 600;
        }

        .form-group button:hover {
            background: linear-gradient(135deg, #003087, #005f99);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .cadastro-sections {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .cadastro-section {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 100%;
        }

        .cadastro-section:last-child {
            max-width: 500px;
            margin: 0 auto;
        }

        .cadastro-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .toggle-button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #001f3f, #003087);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .toggle-button:hover {
            background: linear-gradient(135deg, #003087, #005f99);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .toggle-button.active {
            background: linear-gradient(135deg, #005f99, #0077cc);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .cadastro-section.hidden {
            display: none;
        }

        .cadastro-section .form-group {
            flex-direction: column;
        }

        .cadastro-section .input-group {
            display: flex;
            flex-wrap: nowrap;
            gap: 15px;
        }

        .cadastro-section .input-group input#mnemonico, .cadastro-section .input-group input#tipo {
            flex: 1;
            min-width: 75px;
            max-width: 150px;
        }

        .cadastro-section .input-group input#legenda {
            flex: 1;
            min-width: 150px;
            max-width: 300px;
        }

        .list-items {
            margin-top: 15px;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .list-item:hover {
            background-color: #f1f1f1;
        }

        .list-item button {
            background: linear-gradient(135deg, #ff4d4d, #cc0000);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .list-item button:hover {
            background: linear-gradient(135deg, #cc0000, #a30000);
            transform: translateY(-1px);
        }

        .mnemonico-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .mnemonico-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .mnemonico-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .mnemonico-card .card-content {
            display: flex;
            flex-wrap: nowrap;
            gap: 10px;
            align-items: flex-end;
            overflow-x: auto;
        }

        .mnemonico-card .card-field {
            display: flex;
            flex-direction: column;
            min-width: 100px;
            flex-shrink: 0;
        }

        .mnemonico-card .card-field label {
            font-size: 12px;
            font-weight: 600;
            color: #001f3f;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .mnemonico-card .card-field input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .mnemonico-card .card-field input:focus {
            border-color: #005f99;
            outline: none;
            box-shadow: 0 0 5px rgba(0, 95, 153, 0.2);
        }

        .mnemonico-card .delete-card {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ff4d4d, #cc0000);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 600;
        }

        .mnemonico-card .delete-card:hover {
            background: linear-gradient(135deg, #cc0000, #a30000);
            transform: translateY(-1px);
        }

        .dados-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .dados-card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: nowrap;
            gap: 15px;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .dados-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .dados-card .field {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .dados-card input, .dados-card select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
            background-color: #f9f9f9;
        }

        .dados-card input#data {
            max-width: 150px;
        }

        .dados-card input[readonly]:not([type="date"]) {
            max-width: 150px;
            background-color: #f0f0f0;
            color: #555;
        }

        .dados-card input[type="number"] {
            max-width: 100px;
        }

        .dados-card input.invalid {
            border-color: #ff4d4d;
            background-color: #ffecec;
        }

        .delete-card {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #ff4d4d;
            transition: color 0.2s;
        }

        .delete-card:hover {
            color: #cc0000;
        }

        /* Pagina√ß√£o */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 8px 15px;
            background: linear-gradient(135deg, #001f3f, #003087);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .pagination button:hover {
            background: linear-gradient(135deg, #003087, #005f99);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .pagination button.active {
            background: linear-gradient(135deg, #005f99, #0077cc);
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .pagination button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Estilos para o Dashboard */
        .dashboard-filter {
            background: linear-gradient(135deg, #ffffff, #f9f9f9);
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: nowrap;
            gap: 20px;
            align-items: flex-end;
            transition: box-shadow 0.3s ease;
        }

        .dashboard-filter:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .dashboard-filter select {
            min-width: 120px;
            max-width: 150px;
            padding: 12px 35px 12px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="%23001f3f" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dashboard-filter select:focus {
            border-color: #005f99;
            box-shadow: 0 0 12px rgba(0, 95, 153, 0.3), 0 4px 8px rgba(0,0,0,0.15);
            outline: none;
            transform: translateY(-1px);
        }

        .dashboard-filter select:hover {
            border-color: #005f99;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-1px);
        }

        .dashboard-filter .info-field {
            display: flex;
            flex-direction: column;
        }

        .dashboard-filter label {
            font-weight: 600;
            color: #001f3f;
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dashboard-filter .info-field span {
            padding: 12px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-radius: 8px;
            min-width: 120px;
            max-width: 150px;
            color: #495057;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .dashboard-filter .info-field.legenda span {
            min-width: 200px;
            max-width: 300px;
            text-align: left;
        }

        .dashboard-filter .info-field span:hover {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            border-color: #005f99;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .dashboard-filter button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #001f3f, #003087);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .dashboard-filter button:hover {
            background: linear-gradient(135deg, #003087, #005f99);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .dashboard-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .dashboard-table th, .dashboard-table td {
            border: 1px solid #ddd;
            padding: 12px 15px;
            text-align: left;
            font-size: 14px;
        }

        .dashboard-table th {
            background: linear-gradient(135deg, #001f3f, #003087);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dashboard-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .dashboard-table tr:hover {
            background-color: #e6f0fa;
            transform: scale(1.01);
            transition: background-color 0.2s, transform 0.2s;
        }

        .dashboard-table td {
            color: #333;
            transition: color 0.2s;
        }

        .dashboard-table td.out-of-range {
            background-color: #ffebee !important;
            color: #c62828 !important;
            font-weight: bold;
        }

        .dashboard-table td.at-limit {
            background-color: #fff8e1 !important;
            color: #f57c00 !important;
            font-weight: bold;
        }

        .dashboard-table td.out-of-range::after {
            content: "‚ö†Ô∏è";
            margin-left: 8px;
            font-size: 16px;
        }

        .dashboard-table td.at-limit::after {
            content: "‚ö°";
            margin-left: 8px;
            font-size: 16px;
        }

        /* Estilos para os gr√°ficos */
        .charts-container {
            display: flex;
            gap: 30px;
            margin-top: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #ffffff, #f9f9f9);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chart-wrapper {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-title {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: #001f3f;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }
    </style>
</head>
<body>
    <header class="header">
    <img src="https://raw.githubusercontent.com/LaboratorioLamic/Dados/889745f5320300e54e3c1de1f8255a95f7e4b5bc/assents/logo.png" alt="Logo" class="header-logo">
    <h1>Controle de Temperatura</h1>
    <div class="unit-subtitle" id="selected-unit">Selecione uma Unidade</div>
    <button class="change-unit-button" onclick="openUnitModal()">Trocar Unidade</button>
</header>

<nav>
    <div class="tabs">
        <button class="tab-button active" data-tab="dashboard">Dashboard</button>
        <button class="tab-button" data-tab="cadastro">Cadastro</button>
        <button class="tab-button" data-tab="dados">Dados</button>
    </div>
</nav>

    <div class="modal" id="unit-modal">
        <div class="modal-content">
            <h3>Selecionar Unidade</h3>
            <select id="unit-select">
                <option value="">Selecione uma Unidade</option>
                <option value="01 - Unidade NTO">01 - Unidade NTO</option>
                <option value="03 - Unidade Crato">03 - Unidade Crato</option>
                <option value="05 - Unidade Novo Juazeiro">05 - Unidade Novo Juazeiro</option>
                <option value="06 - Unidade Milagres">06 - Unidade Milagres</option>
                <option value="09 - Unidade Barro">09 - Unidade Barro</option>
                <option value="10 - Unidade Office Cariri">10 - Unidade Office Cariri</option>
                <option value="12 - Unidade Cariria√ßu">12 - Unidade Cariria√ßu</option>
                <option value="13 - Unidade Campos Sales">13 - Unidade Campos Sales</option>
                <option value="14 - Unidade Nova Olinda">14 - Unidade Nova Olinda</option>
                <option value="16 - Unidade Araripe">16 - Unidade Araripe</option>
                <option value="23 - Unidade Salesianos">23 - Unidade Salesianos</option>
                <option value="62 - Unidade Clemir Arrais">62 - Unidade Clemir Arrais</option>
                <option value="88 - Unidade Unicardio">88 - Unidade Unicardio</option>
                <option value="97 - Unidade Endoclinic">97 - Unidade Endoclinic</option>
            </select>
            <button onclick="selectUnit()">Confirmar</button>
        </div>
    </div>

    <div class="content">
        <div class="content-frame">
            <div id="dashboard" class="tab-content active">
                <h2>Dashboard - Dados de Temperatura</h2>
                <div class="dashboard-filter">
                    <div>
                        <label>M√™s</label>
                        <select id="filter-mes">
                            <option value="">Selecione</option>
                            <option value="1">Janeiro</option>
                            <option value="2">Fevereiro</option>
                            <option value="3">Mar√ßo</option>
                            <option value="4">Abril</option>
                            <option value="5">Maio</option>
                            <option value="6">Junho</option>
                            <option value="7">Julho</option>
                            <option value="8">Agosto</option>
                            <option value="9">Setembro</option>
                            <option value="10">Outubro</option>
                            <option value="11">Novembro</option>
                            <option value="12">Dezembro</option>
                        </select>
                    </div>
                    <div>
                        <label>Ano</label>
                        <select id="filter-ano"></select>
                    </div>
                    <div>
                        <label>Mnemonico</label>
                        <select id="filter-mnemonico">
                            <option value="">Selecione</option>
                        </select>
                    </div>
                    <div class="info-field">
                        <label>Tipo</label>
                        <span id="mnemonico-tipo"></span>
                    </div>
                    <div class="info-field legenda">
                        <label>Legenda</label>
                        <span id="mnemonico-legenda"></span>
                    </div>
                    <div class="info-field">
                        <label>Min</label>
                        <span id="mnemonico-min"></span>
                    </div>
                    <div class="info-field">
                        <label>Max</label>
                        <span id="mnemonico-max"></span>
                    </div>
                </div>
                <table class="dashboard-table" id="dashboard-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Mnemonico</th>
                            <th>Respons√°vel</th>
                            <th>‚õÖ Min ¬∫C</th>
                            <th>‚õÖ Max ¬∫C</th>
                            <th>‚õÖ Atual ¬∫C</th>
                            <th>üåû Min ¬∫C</th>
                            <th>üåû Max ¬∫C</th>
                            <th>üåû Atual ¬∫C</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="charts-container">
                    <div class="chart-wrapper">
                        <div class="chart-title">‚õÖ Temperaturas da Manh√£</div>
                        <div class="chart-container">
                            <canvas id="manhaChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <div class="chart-title">üåû Temperaturas da Tarde</div>
                        <div class="chart-container">
                            <canvas id="tardeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div id="cadastro" class="tab-content">
                <h2>Cadastro de informa√ß√µes</h2>
                <div class="cadastro-buttons">
                    <button class="toggle-button" onclick="toggleCadastroSection('mnemonicos')">
                        <span id="mnemonicos-toggle-text">Mnemonicos</span>
                    </button>
                    <button class="toggle-button" onclick="toggleCadastroSection('responsaveis')">
                        <span id="responsaveis-toggle-text">Respons√°veis</span>
                    </button>
                </div>
                <div class="cadastro-sections">
                    <div class="cadastro-section" id="mnemonicos-section">
                        <h3>Mnemonicos</h3>
                        <div class="form-group">
                            <div class="input-group">
                                <div>
                                    <label for="mnemonico">Mnemonico</label>
                                    <input type="text" id="mnemonico">
                                </div>
                                <div>
                                    <label for="tipo">Tipo</label>
                                    <input type="text" id="tipo">
                                </div>
                                <div>
                                    <label for="legenda">Legenda</label>
                                    <input type="text" id="legenda">
                                </div>
                                <div>
                                    <label for="min">Min</label>
                                    <input type="number" id="min" step="0.1">
                                </div>
                                <div>
                                    <label for="max">Max</label>
                                    <input type="number" id="max" step="0.1">
                                </div>
                            </div>
                            <button onclick="addMnemonico()">Adicionar</button>
                        </div>
                        <div class="mnemonico-cards" id="mnemonicos-list"></div>
                    </div>
                    <div class="cadastro-section" id="responsaveis-section">
                        <h3>Cadastro de Respons√°veis</h3>
                        <div class="form-group">
                            <div>
                                <label for="responsavel">Respons√°vel</label>
                                <input type="text" id="responsavel">
                            </div>
                            <button onclick="addResponsavel()">Adicionar</button>
                        </div>
                        <div class="list-items" id="responsaveis-list"></div>
                    </div>
                </div>
            </div>
            <div id="dados" class="tab-content">
                <h2>Dados de Temperatura</h2>
                <div class="form-group">
                    <div>
                        <label>Data</label>
                        <input type="date" id="data">
                    </div>
                    <div>
                        <label>Mnemonico</label>
                        <select id="dados-mnemonico">
                            <option value="">Selecione</option>
                        </select>
                    </div>
                    <div>
                        <label>Respons√°vel</label>
                        <select id="dados-responsavel">
                            <option value="">Selecione</option>
                        </select>
                    </div>
                    <div>
                        <label>‚õÖ Min ¬∫C</label>
                        <input type="number" id="manha-min" step="0.1">
                    </div>
                    <div>
                        <label>‚õÖ Max ¬∫C</label>
                        <input type="number" id="manha-max" step="0.1">
                    </div>
                    <div>
                        <label>‚õÖ Atual ¬∫C</label>
                        <input type="number" id="manha-atual" step="0.1">
                    </div>
                    <div>
                        <label>üåû Min ¬∫C</label>
                        <input type="number" id="tarde-min" step="0.1">
                    </div>
                    <div>
                        <label>üåû Max ¬∫C</label>
                        <input type="number" id="tarde-max" step="0.1">
                    </div>
                    <div>
                        <label>üåû Atual ¬∫C</label>
                        <input type="number" id="tarde-atual" step="0.1">
                    </div>
                    <button onclick="addDado()">Adicionar</button>
                </div>
                <div class="dados-cards" id="dados-cards"></div>
                <div class="pagination" id="pagination"></div>
            </div>
        </div>
    </div>

    <script>
// Configura√ß√£o do JSONBin.io
const JSONBIN_API_KEY = '$2a$10$cREwumm/vr2Mj149sDZkKuXLp.pxT0D6PMgkf.yMEWR7YmIlrHJtm';
const JSONBIN_BASE_URL = 'https://api.jsonbin.io/v3/b';
const JSONBIN_ID = '68c1c26343b1c97be93e4563';

// Dados em mem√≥ria
let mnemonicos = [];
let responsaveis = [];
let dados = [];
let currentPage = 1;
const itemsPerPage = 10;
const maxPagesDisplayed = 5;
let selectedUnit = null;

// Vari√°veis para os gr√°ficos
let manhaChart = null;
let tardeChart = null;

// Fun√ß√µes para comunica√ß√£o com JSONBin.io
async function saveToJsonBin() {
    const data = { mnemonicos, responsaveis, dados };
    try {
        const response = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_ID}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': JSONBIN_API_KEY
            },
            body: JSON.stringify(data)
        });
        if (!response.ok) {
            throw new Error('Erro ao salvar no JSONBin');
        }
    } catch (error) {
        console.error('Erro ao salvar:', error);
        alert('Erro ao salvar os dados no servidor.');
    }
}

async function loadFromJsonBin() {
    try {
        const response = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_ID}/latest`, {
            headers: {
                'X-Master-Key': JSONBIN_API_KEY
            }
        });
        if (response.ok) {
            const result = await response.json();
            const data = result.record;
            mnemonicos = data.mnemonicos || [];
            responsaveis = data.responsaveis || [];
            dados = data.dados || [];
            updateUnitDisplay();
            renderMnemonicos();
            renderResponsaveis();
            renderDropdowns();
            renderDadosCards();
            renderPagination();
            renderDashboardTable();
            updateCharts();
        } else {
            throw new Error('Erro ao carregar do JSONBin');
        }
    } catch (error) {
        console.error('Erro ao carregar:', error);
    }
}

// Fun√ß√£o para abrir a janela modal
function openUnitModal() {
    const modal = document.getElementById('unit-modal');
    modal.style.display = 'flex';
    document.getElementById('unit-select').value = selectedUnit || '';
}

// Fun√ß√£o para selecionar a unidade
async function selectUnit() {
    const select = document.getElementById('unit-select');
    selectedUnit = select.value;
    localStorage.setItem('selectedUnit', selectedUnit);
    updateUnitDisplay();
    document.getElementById('unit-modal').style.display = 'none';
    renderMnemonicos();
    renderResponsaveis();
    renderDropdowns();
    renderDadosCards();
    renderPagination();
    renderDashboardTable();
    updateCharts();
}

// Fun√ß√£o para atualizar a exibi√ß√£o da unidade selecionada
function updateUnitDisplay() {
    const unitDisplay = document.getElementById('selected-unit');
    unitDisplay.textContent = selectedUnit || 'Selecione uma Unidade';
}

// Fun√ß√µes para Cadastro de Mnemonicos
async function addMnemonico() {
    if (!selectedUnit) {
        alert('Por favor, selecione uma unidade antes de adicionar um mnemonico.');
        return;
    }
    const mnemonico = document.getElementById('mnemonico').value.trim();
    const tipo = document.getElementById('tipo').value.trim();
    const legenda = document.getElementById('legenda').value.trim();
    const min = parseFloat(document.getElementById('min').value);
    const max = parseFloat(document.getElementById('max').value);
    if (mnemonico && tipo && legenda && !isNaN(min) && !isNaN(max)) {
        mnemonicos.push({ mnemonico, tipo, legenda, min, max, unit: selectedUnit });
        await saveToJsonBin();
        renderMnemonicos();
        renderDropdowns();
        document.getElementById('mnemonico').value = '';
        document.getElementById('tipo').value = '';
        document.getElementById('legenda').value = '';
        document.getElementById('min').value = '';
        document.getElementById('max').value = '';
    } else {
        alert('Por favor, preencha todos os campos do mnemonico.');
    }
}

async function updateMnemonico(index, field, value) {
    if (field === 'min' || field === 'max') {
        if (isNaN(value)) return;
    }
    mnemonicos[index][field] = value;
    await saveToJsonBin();
    renderDropdowns();
    renderDashboardTable();
}

async function deleteMnemonico(index) {
    mnemonicos.splice(index, 1);
    await saveToJsonBin();
    renderMnemonicos();
    renderDropdowns();
    renderDashboardTable();
}

function renderMnemonicos() {
    const list = document.getElementById('mnemonicos-list');
    list.innerHTML = '';
    const filteredMnemonicos = mnemonicos.filter(item => item.unit === selectedUnit);
    filteredMnemonicos.forEach((item, index) => {
        const globalIndex = mnemonicos.findIndex(m => m === item);
        const card = document.createElement('div');
        card.className = 'mnemonico-card';
        card.innerHTML = `
            <div class="card-content">
                <div class="card-field">
                    <label>Mnemonico</label>
                    <input type="text" value="${item.mnemonico}" onchange="updateMnemonico(${globalIndex}, 'mnemonico', this.value)">
                </div>
                <div class="card-field">
                    <label>Tipo</label>
                    <input type="text" value="${item.tipo}" onchange="updateMnemonico(${globalIndex}, 'tipo', this.value)">
                </div>
                <div class="card-field">
                    <label>Legenda</label>
                    <input type="text" value="${item.legenda}" onchange="updateMnemonico(${globalIndex}, 'legenda', this.value)">
                </div>
                <div class="card-field">
                    <label>Min</label>
                    <input type="number" step="0.1" value="${item.min}" onchange="updateMnemonico(${globalIndex}, 'min', parseFloat(this.value))">
                </div>
                <div class="card-field">
                    <label>Max</label>
                    <input type="number" step="0.1" value="${item.max}" onchange="updateMnemonico(${globalIndex}, 'max', parseFloat(this.value))">
                </div>
            </div>
            <button class="delete-card" onclick="deleteMnemonico(${globalIndex})">Excluir</button>
        `;
        list.appendChild(card);
    });
}

// Fun√ß√µes para Cadastro de Respons√°veis
async function addResponsavel() {
    if (!selectedUnit) {
        alert('Por favor, selecione uma unidade antes de adicionar um respons√°vel.');
        return;
    }
    const responsavel = document.getElementById('responsavel').value.trim();
    if (responsavel) {
        responsaveis.push({ name: responsavel, unit: selectedUnit });
        await saveToJsonBin();
        renderResponsaveis();
        renderDropdowns();
        document.getElementById('responsavel').value = '';
    }
}

async function deleteResponsavel(index) {
    responsaveis.splice(index, 1);
    await saveToJsonBin();
    renderResponsaveis();
    renderDropdowns();
}

function renderResponsaveis() {
    const list = document.getElementById('responsaveis-list');
    list.innerHTML = '';
    const filteredResponsaveis = responsaveis.filter(item => item.unit === selectedUnit);
    filteredResponsaveis.forEach((item, index) => {
        const globalIndex = responsaveis.findIndex(r => r === item);
        const div = document.createElement('div');
        div.className = 'list-item';
        div.innerHTML = `<span>${item.name}</span>
                         <button onclick="deleteResponsavel(${globalIndex})">Excluir</button>`;
        list.appendChild(div);
    });
}

// Fun√ß√µes para Dropdowns
function renderDropdowns() {
    const mnemonicoSelect = document.getElementById('dados-mnemonico');
    mnemonicoSelect.innerHTML = '<option value="">Selecione</option>';
    const filterMnemonicoSelect = document.getElementById('filter-mnemonico');
    filterMnemonicoSelect.innerHTML = '<option value="">Selecione</option>';
    const filteredMnemonicos = mnemonicos.filter(item => item.unit === selectedUnit);
    filteredMnemonicos.forEach(item => {
        const option = document.createElement('option');
        option.value = item.mnemonico;
        option.textContent = item.mnemonico;
        mnemonicoSelect.appendChild(option.cloneNode(true));
        filterMnemonicoSelect.appendChild(option);
    });

    const responsavelSelect = document.getElementById('dados-responsavel');
    responsavelSelect.innerHTML = '<option value="">Selecione</option>';
    const filteredResponsaveis = responsaveis.filter(item => item.unit === selectedUnit);
    filteredResponsaveis.forEach(item => {
        const option = document.createElement('option');
        option.value = item.name;
        option.textContent = item.name;
        responsavelSelect.appendChild(option);
    });
}

// Fun√ß√µes para Dados
async function addDado() {
    if (!selectedUnit) {
        alert('Por favor, selecione uma unidade antes de adicionar dados.');
        return;
    }
    if (dados.filter(item => item.unit === selectedUnit).length >= 50) {
        alert('Limite m√°ximo de 50 dados atingido para esta unidade.');
        return;
    }
    const data = document.getElementById('data').value;
    const mnemonico = document.getElementById('dados-mnemonico').value;
    const responsavel = document.getElementById('dados-responsavel').value;
    
    // Campos Manh√£
    const manhaMin = parseFloat(document.getElementById('manha-min').value);
    const manhaMax = parseFloat(document.getElementById('manha-max').value);
    const manhaAtual = parseFloat(document.getElementById('manha-atual').value);
    
    // Campos Tarde
    const tardeMin = parseFloat(document.getElementById('tarde-min').value);
    const tardeMax = parseFloat(document.getElementById('tarde-max').value);
    const tardeAtual = parseFloat(document.getElementById('tarde-atual').value);

    if (validateDado(manhaMin, manhaMax, manhaAtual, tardeMin, tardeMax, tardeAtual) && data && mnemonico && responsavel) {
        dados.unshift({ 
            data, 
            mnemonico, 
            responsavel, 
            manhaMin, 
            manhaMax, 
            manhaAtual,
            tardeMin, 
            tardeMax, 
            tardeAtual,
            unit: selectedUnit
        });
        dados.sort((a, b) => new Date(b.data) - new Date(a.data));
        if (dados.filter(item => item.unit === selectedUnit).length > 50) {
            const oldest = dados.filter(item => item.unit === selectedUnit).slice(-1)[0];
            const index = dados.findIndex(item => item === oldest);
            dados.splice(index, 1);
        }
        await saveToJsonBin();
        currentPage = 1;
        renderDadosCards();
        renderPagination();
        renderDashboardTable();
        clearDadosForm();
    } else {
        alert('Por favor, corrija os campos inv√°lidos.');
    }
}

function validateDado(manhaMin, manhaMax, manhaAtual, tardeMin, tardeMax, tardeAtual) {
    const manhaMinInput = document.getElementById('manha-min');
    const manhaMaxInput = document.getElementById('manha-max');
    const manhaAtualInput = document.getElementById('manha-atual');
    const tardeMinInput = document.getElementById('tarde-min');
    const tardeMaxInput = document.getElementById('tarde-max');
    const tardeAtualInput = document.getElementById('tarde-atual');
    const mnemonicoSelect = document.getElementById('dados-mnemonico');
    const responsavelSelect = document.getElementById('dados-responsavel');

    // Limpar classes inv√°lidas
    [manhaMinInput, manhaMaxInput, manhaAtualInput, tardeMinInput, tardeMaxInput, tardeAtualInput, mnemonicoSelect, responsavelSelect].forEach(input => {
        input.classList.remove('invalid');
    });

    let valid = true;

    // Validar se s√£o n√∫meros
    if (isNaN(manhaMin) || isNaN(manhaMax) || isNaN(manhaAtual) || isNaN(tardeMin) || isNaN(tardeMax) || isNaN(tardeAtual)) {
        if (isNaN(manhaMin)) manhaMinInput.classList.add('invalid');
        if (isNaN(manhaMax)) manhaMaxInput.classList.add('invalid');
        if (isNaN(manhaAtual)) manhaAtualInput.classList.add('invalid');
        if (isNaN(tardeMin)) tardeMinInput.classList.add('invalid');
        if (isNaN(tardeMax)) tardeMaxInput.classList.add('invalid');
        if (isNaN(tardeAtual)) tardeAtualInput.classList.add('invalid');
        valid = false;
    }

    if (!mnemonicoSelect.value) {
        mnemonicoSelect.classList.add('invalid');
        valid = false;
    }

    if (!responsavelSelect.value) {
        responsavelSelect.classList.add('invalid');
        valid = false;
    }

    // Validar l√≥gica Manh√£
    if (manhaMin > manhaAtual || manhaMin > manhaMax) {
        manhaMinInput.classList.add('invalid');
        valid = false;
    }
    if (manhaMax < manhaAtual || manhaMax < manhaMin) {
        manhaMaxInput.classList.add('invalid');
        valid = false;
    }
    if (manhaAtual < manhaMin || manhaAtual > manhaMax) {
        manhaAtualInput.classList.add('invalid');
        valid = false;
    }

    // Validar l√≥gica Tarde
    if (tardeMin > tardeAtual || tardeMin > tardeMax) {
        tardeMinInput.classList.add('invalid');
        valid = false;
    }
    if (tardeMax < tardeAtual || tardeMax < tardeMin) {
        tardeMaxInput.classList.add('invalid');
        valid = false;
    }
    if (tardeAtual < tardeMin || tardeAtual > tardeMax) {
        tardeAtualInput.classList.add('invalid');
        valid = false;
    }

    return valid;
}

function clearDadosForm() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('data').value = today;
    document.getElementById('dados-mnemonico').value = '';
    document.getElementById('dados-responsavel').value = '';
    
    // Limpar campos Manh√£
    document.getElementById('manha-min').value = '';
    document.getElementById('manha-max').value = '';
    document.getElementById('manha-atual').value = '';
    
    // Limpar campos Tarde
    document.getElementById('tarde-min').value = '';
    document.getElementById('tarde-max').value = '';
    document.getElementById('tarde-atual').value = '';
    
    // Remover classes inv√°lidas
    const inputs = ['manha-min', 'manha-max', 'manha-atual', 'tarde-min', 'tarde-max', 'tarde-atual', 'dados-mnemonico', 'dados-responsavel'];
    inputs.forEach(id => {
        document.getElementById(id).classList.remove('invalid');
    });
}

function renderDadosCards() {
    const cardsContainer = document.getElementById('dados-cards');
    cardsContainer.innerHTML = '';
    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const filteredDados = dados.filter(item => item.unit === selectedUnit);
    const paginatedDados = filteredDados.slice(start, end);

    paginatedDados.forEach((item, index) => {
        const globalIndex = dados.findIndex(d => d === item);
        const card = document.createElement('div');
        card.className = 'dados-card';
        card.innerHTML = `
            <div class="field">
                <label>Data</label>
                <input type="date" id="data" value="${item.data}" onchange="updateDado(${globalIndex}, 'data', this.value)">
            </div>
            <div class="field">
                <label>Mnemonico</label>
                <input type="text" value="${item.mnemonico}" readonly>
            </div>
            <div class="field">
                <label>Respons√°vel</label>
                <input type="text" value="${item.responsavel}" readonly>
            </div>
            <div class="field">
                <label>‚õÖ Min ¬∫C</label>
                <input type="number" step="0.1" value="${item.manhaMin || ''}" onchange="updateDado(${globalIndex}, 'manhaMin', parseFloat(this.value))">
            </div>
            <div class="field">
                <label>‚õÖ Max ¬∫C</label>
                <input type="number" step="0.1" value="${item.manhaMax || ''}" onchange="updateDado(${globalIndex}, 'manhaMax', parseFloat(this.value))">
            </div>
            <div class="field">
                <label>‚õÖ Atual ¬∫C</label>
                <input type="number" step="0.1" value="${item.manhaAtual || ''}" onchange="updateDado(${globalIndex}, 'manhaAtual', parseFloat(this.value))">
            </div>
            <div class="field">
                <label>üåû Min ¬∫C</label>
                <input type="number" step="0.1" value="${item.tardeMin || ''}" onchange="updateDado(${globalIndex}, 'tardeMin', parseFloat(this.value))">
            </div>
            <div class="field">
                <label>üåû Max ¬∫C</label>
                <input type="number" step="0.1" value="${item.tardeMax || ''}" onchange="updateDado(${globalIndex}, 'tardeMax', parseFloat(this.value))">
            </div>
            <div class="field">
                <label>üåû Atual ¬∫C</label>
                <input type="number" step="0.1" value="${item.tardeAtual || ''}" onchange="updateDado(${globalIndex}, 'tardeAtual', parseFloat(this.value))">
            </div>
            <button class="delete-card" onclick="deleteDado(${globalIndex})">&#10006;</button>
        `;
        cardsContainer.appendChild(card);
        validateCard(globalIndex);
    });
    renderPagination();
}

async function updateDado(index, field, value) {
    if (field === 'data') {
        dados[index][field] = value;
        dados.sort((a, b) => new Date(b.data) - new Date(a.data));
        await saveToJsonBin();
        renderDadosCards();
        renderPagination();
        renderDashboardTable();
    } else {
        dados[index][field] = parseFloat(value);
        await saveToJsonBin();
        validateCard(index);
        renderDashboardTable();
    }
}

function validateCard(index) {
    if (index >= dados.length) return;
    const card = document.querySelectorAll('.dados-card')[index % itemsPerPage];
    if (!card) return;
    
    // Manh√£
    const manhaMinInput = card.querySelector('input[onchange*="manhaMin"]');
    const manhaMaxInput = card.querySelector('input[onchange*="manhaMax"]');
    const manhaAtualInput = card.querySelector('input[onchange*="manhaAtual"]');
    
    // Tarde
    const tardeMinInput = card.querySelector('input[onchange*="tardeMin"]');
    const tardeMaxInput = card.querySelector('input[onchange*="tardeMax"]');
    const tardeAtualInput = card.querySelector('input[onchange*="tardeAtual"]');

    const manhaMin = dados[index].manhaMin;
    const manhaMax = dados[index].manhaMax;
    const manhaAtual = dados[index].manhaAtual;
    const tardeMin = dados[index].tardeMin;
    const tardeMax = dados[index].tardeMax;
    const tardeAtual = dados[index].tardeAtual;

    // Limpar classes inv√°lidas
    [manhaMinInput, manhaMaxInput, manhaAtualInput, tardeMinInput, tardeMaxInput, tardeAtualInput].forEach(input => {
        if (input) input.classList.remove('invalid');
    });

    // Validar Manh√£
    if (manhaMin > manhaAtual || manhaMin > manhaMax) {
        if (manhaMinInput) manhaMinInput.classList.add('invalid');
    }
    if (manhaMax < manhaAtual || manhaMax < manhaMin) {
        if (manhaMaxInput) manhaMaxInput.classList.add('invalid');
    }
    if (manhaAtual < manhaMin || manhaAtual > manhaMax) {
        if (manhaAtualInput) manhaAtualInput.classList.add('invalid');
    }

    // Validar Tarde
    if (tardeMin > tardeAtual || tardeMin > tardeMax) {
        if (tardeMinInput) tardeMinInput.classList.add('invalid');
    }
    if (tardeMax < tardeAtual || tardeMax < tardeMin) {
        if (tardeMaxInput) tardeMaxInput.classList.add('invalid');
    }
    if (tardeAtual < tardeMin || tardeAtual > tardeMax) {
        if (tardeAtualInput) tardeAtualInput.classList.add('invalid');
    }
}

async function deleteDado(index) {
    dados.splice(index, 1);
    if (currentPage > Math.ceil(dados.filter(item => item.unit === selectedUnit).length / itemsPerPage)) {
        currentPage = Math.max(1, Math.ceil(dados.filter(item => item.unit === selectedUnit).length / itemsPerPage));
    }
    dados.sort((a, b) => new Date(b.data) - new Date(a.data));
    await saveToJsonBin();
    renderDadosCards();
    renderPagination();
    renderDashboardTable();
}

function renderPagination() {
    const paginationContainer = document.getElementById('pagination');
    paginationContainer.innerHTML = '';
    const filteredDados = dados.filter(item => item.unit === selectedUnit);
    const totalPages = Math.ceil(filteredDados.length / itemsPerPage);

    if (totalPages <= 1) return;

    let startPage = Math.max(1, currentPage - Math.floor(maxPagesDisplayed / 2));
    let endPage = Math.min(totalPages, startPage + maxPagesDisplayed - 1);

    if (endPage - startPage + 1 < maxPagesDisplayed) {
        startPage = Math.max(1, endPage - maxPagesDisplayed + 1);
    }

    for (let i = startPage; i <= endPage; i++) {
        const button = document.createElement('button');
        button.textContent = i;
        button.className = i === currentPage ? 'active' : '';
        button.addEventListener('click', () => {
            currentPage = i;
            renderDadosCards();
            renderPagination();
        });
        paginationContainer.appendChild(button);
    }

    const lastButton = document.createElement('button');
    lastButton.textContent = '>';
    lastButton.disabled = currentPage === totalPages;
    lastButton.addEventListener('click', () => {
        currentPage = totalPages;
        renderDadosCards();
        renderPagination();
    });
    paginationContainer.appendChild(lastButton);
}

// Fun√ß√µes para persist√™ncia dos filtros do dashboard
function saveDashboardFilters() {
    const filters = {
        mes: document.getElementById('filter-mes').value,
        ano: document.getElementById('filter-ano').value,
        mnemonico: document.getElementById('filter-mnemonico').value
    };
    localStorage.setItem(`dashboardFilters_${selectedUnit}`, JSON.stringify(filters));
}

function loadDashboardFilters() {
    const savedFilters = localStorage.getItem(`dashboardFilters_${selectedUnit}`);
    if (savedFilters) {
        const filters = JSON.parse(savedFilters);
        document.getElementById('filter-mes').value = filters.mes || '';
        document.getElementById('filter-ano').value = filters.ano || '';
        document.getElementById('filter-mnemonico').value = filters.mnemonico || '';
        
        // Atualizar campos informativos se mnemonico estiver selecionado
        if (filters.mnemonico) {
            const mnemonicoData = mnemonicos.find(item => item.mnemonico === filters.mnemonico && item.unit === selectedUnit);
            if (mnemonicoData) {
                document.getElementById('mnemonico-tipo').textContent = mnemonicoData.tipo;
                document.getElementById('mnemonico-legenda').textContent = mnemonicoData.legenda;
                document.getElementById('mnemonico-min').textContent = mnemonicoData.min.toFixed(1);
                document.getElementById('mnemonico-max').textContent = mnemonicoData.max.toFixed(1);
            }
        }
    }
}

// Fun√ß√£o para controlar as abas de cadastro
function toggleCadastroSection(section) {
    document.getElementById('mnemonicos-section').classList.add('hidden');
    document.getElementById('responsaveis-section').classList.add('hidden');
    
    document.querySelectorAll('.toggle-button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    const sectionElement = document.getElementById(`${section}-section`);
    sectionElement.classList.remove('hidden');
    
    const button = event.target.closest('.toggle-button');
    button.classList.add('active');
}

// Fun√ß√£o para formatar data no formato brasileiro
function formatDateBR(dateString) {
    const date = new Date(dateString);
    const day = date.getDate().toString().padStart(2, '0');
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
}

// Fun√ß√µes para os gr√°ficos
function createCharts() {
    createManhaChart();
    createTardeChart();
}

function createManhaChart() {
    const ctx = document.getElementById('manhaChart').getContext('2d');
    
    if (manhaChart) {
        manhaChart.destroy();
    }

    const filteredDados = getFilteredDataForCharts();
    const mnemonicoData = getCurrentMnemonicoData();

    manhaChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: filteredDados.map(item => formatDateBR(item.data)),
            datasets: [
                {
                    label: 'Min ¬∫C',
                    data: filteredDados.map(item => item.manhaMin || 0),
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Max ¬∫C',
                    data: filteredDados.map(item => item.manhaMax || 0),
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Atual ¬∫C',
                    data: filteredDados.map(item => item.manhaAtual || 0),
                    borderColor: '#2ecc71',
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    title: {
                        display: true,
                        text: 'Temperatura (¬∫C)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Data'
                    }
                }
            },
            annotation: {
                annotations: mnemonicoData ? {
                    minLine: {
                        type: 'line',
                        yMin: mnemonicoData.min,
                        yMax: mnemonicoData.min,
                        borderColor: '#ff0000',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        label: {
                            content: `Min Ideal: ${mnemonicoData.min}¬∫C`,
                            enabled: true
                        }
                    },
                    maxLine: {
                        type: 'line',
                        yMin: mnemonicoData.max,
                        yMax: mnemonicoData.max,
                        borderColor: '#ff0000',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        label: {
                            content: `Max Ideal: ${mnemonicoData.max}¬∫C`,
                            enabled: true
                        }
                    }
                } : {}
            }
        }
    });
}

function createTardeChart() {
    const ctx = document.getElementById('tardeChart').getContext('2d');
    
    if (tardeChart) {
        tardeChart.destroy();
    }

    const filteredDados = getFilteredDataForCharts();
    const mnemonicoData = getCurrentMnemonicoData();

    tardeChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: filteredDados.map(item => formatDateBR(item.data)),
            datasets: [
                {
                    label: 'Min ¬∫C',
                    data: filteredDados.map(item => item.tardeMin || 0),
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Max ¬∫C',
                    data: filteredDados.map(item => item.tardeMax || 0),
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Atual ¬∫C',
                    data: filteredDados.map(item => item.tardeAtual || 0),
                    borderColor: '#2ecc71',
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    title: {
                        display: true,
                        text: 'Temperatura (¬∫C)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Data'
                    }
                }
            },
            annotation: {
                annotations: mnemonicoData ? {
                    minLine: {
                        type: 'line',
                        yMin: mnemonicoData.min,
                        yMax: mnemonicoData.min,
                        borderColor: '#ff0000',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        label: {
                            content: `Min Ideal: ${mnemonicoData.min}¬∫C`,
                            enabled: true
                        }
                    },
                    maxLine: {
                        type: 'line',
                        yMin: mnemonicoData.max,
                        yMax: mnemonicoData.max,
                        borderColor: '#ff0000',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        label: {
                            content: `Max Ideal: ${mnemonicoData.max}¬∫C`,
                            enabled: true
                        }
                    }
                } : {}
            }
        }
    });
}

function getFilteredDataForCharts() {
    const mes = document.getElementById('filter-mes').value;
    const ano = document.getElementById('filter-ano').value;
    const mnemonico = document.getElementById('filter-mnemonico').value;

    if (!mes || !ano || !mnemonico || !selectedUnit) {
        return [];
    }

    return dados.filter(item => {
        const itemDate = new Date(item.data);
        const itemMonth = itemDate.getMonth() + 1;
        const itemYear = itemDate.getFullYear();
        return itemMonth === parseInt(mes) &&
               itemYear === parseInt(ano) &&
               item.mnemonico === mnemonico &&
               item.unit === selectedUnit;
    }).sort((a, b) => new Date(a.data) - new Date(a.data));
}

function getCurrentMnemonicoData() {
    const mnemonico = document.getElementById('filter-mnemonico').value;
    return mnemonicos.find(m => m.mnemonico === mnemonico && m.unit === selectedUnit);
}

function updateCharts() {
    if (manhaChart && tardeChart) {
        createManhaChart();
        createTardeChart();
    }
}

// Fun√ß√µes para o Dashboard
function renderDashboardFilters() {
    const anoSelect = document.getElementById('filter-ano');
    const currentYear = new Date().getFullYear();
    anoSelect.innerHTML = '<option value="">Selecione</option>';
    for (let i = currentYear; i >= currentYear - 4; i--) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        anoSelect.appendChild(option);
    }

    document.getElementById('filter-mnemonico').addEventListener('change', function() {
        const mnemonico = this.value;
        const mnemonicoData = mnemonicos.find(item => item.mnemonico === mnemonico && item.unit === selectedUnit);
        document.getElementById('mnemonico-tipo').textContent = mnemonicoData ? mnemonicoData.tipo : '';
        document.getElementById('mnemonico-legenda').textContent = mnemonicoData ? mnemonicoData.legenda : '';
        document.getElementById('mnemonico-min').textContent = mnemonicoData ? mnemonicoData.min.toFixed(1) : '';
        document.getElementById('mnemonico-max').textContent = mnemonicoData ? mnemonicoData.max.toFixed(1) : '';
        saveDashboardFilters();
        renderDashboardTable();
    });

    document.getElementById('filter-mes').addEventListener('change', function() {
        saveDashboardFilters();
        renderDashboardTable();
    });
    
    document.getElementById('filter-ano').addEventListener('change', function() {
        saveDashboardFilters();
        renderDashboardTable();
    });
}

function renderDashboardTable() {
    const mes = document.getElementById('filter-mes').value;
    const ano = document.getElementById('filter-ano').value;
    const mnemonico = document.getElementById('filter-mnemonico').value;
    const tbody = document.querySelector('#dashboard-table tbody');
    tbody.innerHTML = '';

    // S√≥ mostra dados se TODOS os filtros estiverem selecionados
    if (!mes || !ano || !mnemonico || !selectedUnit) {
        return;
    }

    const filteredDados = dados.filter(item => {
        const itemDate = new Date(item.data);
        const itemMonth = itemDate.getMonth() + 1;
        const itemYear = itemDate.getFullYear();
        return itemMonth === parseInt(mes) &&
               itemYear === parseInt(ano) &&
               item.mnemonico === mnemonico &&
               item.unit === selectedUnit;
    }).sort((a, b) => new Date(b.data) - new Date(a.data));

    filteredDados.forEach(item => {
        const row = document.createElement('tr');
        
        // Buscar dados do mnemonico para obter min e max ideais
        const mnemonicoData = mnemonicos.find(m => m.mnemonico === item.mnemonico && m.unit === selectedUnit);
        let manhaMinClass = '', manhaMaxClass = '', manhaAtualClass = '';
        let tardeMinClass = '', tardeMaxClass = '', tardeAtualClass = '';
        if (mnemonicoData) {
            // Validar Manh√£ - Min
            if (item.manhaMin < mnemonicoData.min || item.manhaMin > mnemonicoData.max) {
                manhaMinClass = 'out-of-range';
            } else if (item.manhaMin === mnemonicoData.min || item.manhaMin === mnemonicoData.max) {
                manhaMinClass = 'at-limit';
            }
            
            // Validar Manh√£ - Max
            if (item.manhaMax < mnemonicoData.min || item.manhaMax > mnemonicoData.max) {
                manhaMaxClass = 'out-of-range';
            } else if (item.manhaMax === mnemonicoData.min || item.manhaMax === mnemonicoData.max) {
                manhaMaxClass = 'at-limit';
            }
            
            // Validar Manh√£ - Atual
            if (item.manhaAtual < mnemonicoData.min || item.manhaAtual > mnemonicoData.max) {
                manhaAtualClass = 'out-of-range';
            } else if (item.manhaAtual === mnemonicoData.min || item.manhaAtual === mnemonicoData.max) {
                manhaAtualClass = 'at-limit';
            }
            
            // Validar Tarde - Min
            if (item.tardeMin < mnemonicoData.min || item.tardeMin > mnemonicoData.max) {
                tardeMinClass = 'out-of-range';
            } else if (item.tardeMin === mnemonicoData.min || item.tardeMin === mnemonicoData.max) {
                tardeMinClass = 'at-limit';
            }
            
            // Validar Tarde - Max
            if (item.tardeMax < mnemonicoData.min || item.tardeMax > mnemonicoData.max) {
                tardeMaxClass = 'out-of-range';
            } else if (item.tardeMax === mnemonicoData.min || item.tardeMax === mnemonicoData.max) {
                tardeMaxClass = 'at-limit';
            }
            
            // Validar Tarde - Atual
            if (item.tardeAtual < mnemonicoData.min || item.tardeAtual > mnemonicoData.max) {
                tardeAtualClass = 'out-of-range';
            } else if (item.tardeAtual === mnemonicoData.min || item.tardeAtual === mnemonicoData.max) {
                tardeAtualClass = 'at-limit';
            }
        }
        
        row.innerHTML = `
            <td>${formatDateBR(item.data)}</td>
            <td>${item.mnemonico}</td>
            <td>${item.responsavel}</td>
            <td class="${manhaMinClass}">${(item.manhaMin || 0).toFixed(1)}</td>
            <td class="${manhaMaxClass}">${(item.manhaMax || 0).toFixed(1)}</td>
            <td class="${manhaAtualClass}">${(item.manhaAtual || 0).toFixed(1)}</td>
            <td class="${tardeMinClass}">${(item.tardeMin || 0).toFixed(1)}</td>
            <td class="${tardeMaxClass}">${(item.tardeMax || 0).toFixed(1)}</td>
            <td class="${tardeAtualClass}">${(item.tardeAtual || 0).toFixed(1)}</td>
        `;
        tbody.appendChild(row);
    });
    
    // Atualizar gr√°ficos
    updateCharts();
}

async function init() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('data').value = today;

    // Carregar unidade salva do localStorage
    selectedUnit = localStorage.getItem('selectedUnit') || null;
    updateUnitDisplay();

    await loadFromJsonBin();
    
    // Definir estado inicial das abas (apenas Mnemonicos ativo)
    document.getElementById('responsaveis-section').classList.add('hidden');
    document.querySelector('.toggle-button').classList.add('active');

    // Abrir o modal de sele√ß√£o de unidade se nenhuma unidade estiver selecionada
    if (!selectedUnit) {
        openUnitModal();
    }
}

init();

// JavaScript para interatividade das abas
const tabs = document.querySelectorAll('.tab-button');
const contents = document.querySelectorAll('.tab-content');

tabs.forEach(tab => {
    tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        contents.forEach(c => c.classList.remove('active'));

        tab.classList.add('active');
        const target = document.getElementById(tab.dataset.tab);
        target.classList.add('active');

        if (tab.dataset.tab === 'dados') {
            renderDropdowns();
            renderPagination();
        } else if (tab.dataset.tab === 'dashboard') {
            renderDashboardFilters();
            loadDashboardFilters();
            renderDashboardTable();
            createCharts();
        } else if (tab.dataset.tab === 'cadastro') {
            renderMnemonicos();
            renderResponsaveis();
        }
    });
});

// Valida√ß√£o em tempo real no formul√°rio de Dados
function validateForm() {
    const manhaMin = parseFloat(document.getElementById('manha-min').value);
    const manhaMax = parseFloat(document.getElementById('manha-max').value);
    const manhaAtual = parseFloat(document.getElementById('manha-atual').value);
    const tardeMin = parseFloat(document.getElementById('tarde-min').value);
    const tardeMax = parseFloat(document.getElementById('tarde-max').value);
    const tardeAtual = parseFloat(document.getElementById('tarde-atual').value);
    validateDado(manhaMin, manhaMax, manhaAtual, tardeMin, tardeMax, tardeAtual);
}

document.getElementById('manha-min').addEventListener('input', validateForm);
document.getElementById('manha-max').addEventListener('input', validateForm);
document.getElementById('manha-atual').addEventListener('input', validateForm);
document.getElementById('tarde-min').addEventListener('input', validateForm);
document.getElementById('tarde-max').addEventListener('input', validateForm);
document.getElementById('tarde-atual').addEventListener('input', validateForm);
document.getElementById('dados-mnemonico').addEventListener('change', validateForm);
document.getElementById('dados-responsavel').addEventListener('change', validateForm);
    </script>
</body>
</html>
